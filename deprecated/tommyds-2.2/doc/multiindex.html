<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>TommyDS</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="tommy.css" rel="stylesheet" type="text/css">
</head>
<body>

<!-- Generated by Doxygen 1.7.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Tommy Multi Indexing </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><p>Tommy provides only partial iterator support with the "foreach" functions.</p>
<p>If you need real iterators you have to insert all the objects also in a <a class="el" href="tommylist_8h.html#a45d098412d5f0be21113b252caee491b" title="Double linked list type.">tommy_list</a>, and use the list as iterator.</p>
<p>This technique allows to keep track of the insertion order with the list, and provides more search possibilities using different data structures for different search keys.</p>
<p>See the next example, for a objects inserted in a <a class="el" href="tommylist_8h.html#a45d098412d5f0be21113b252caee491b" title="Double linked list type.">tommy_list</a>, and in two <a class="el" href="tommyhashdyn_8h.html#a00c8b944d273f38f9eef91417a1e8991" title="Hashtable container type.">tommy_hashdyn</a> using different keys.</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">struct </span>object {
     <span class="comment">// data fields</span>
     <span class="keywordtype">int</span> value_0;
     <span class="keywordtype">int</span> value_1;

     <span class="comment">// for containers</span>
     <a class="code" href="structtommy__node__struct.html" title="Data structure node.">tommy_node</a> list_node; <span class="comment">// node for the list</span>
     <a class="code" href="structtommy__node__struct.html" title="Data structure node.">tommy_node</a> hash_node_0; <span class="comment">// node for the first hash</span>
     <a class="code" href="structtommy__node__struct.html" title="Data structure node.">tommy_node</a> hash_node_1; <span class="comment">// node for the second hash</span>
 };

 <span class="comment">// search function for value_1</span>
 <span class="keywordtype">int</span> search_1(<span class="keyword">const</span> <span class="keywordtype">void</span>* arg, <span class="keyword">const</span> <span class="keywordtype">void</span>* obj)
 {
     <span class="keywordflow">return</span> *(<span class="keyword">const</span> <span class="keywordtype">int</span>*)arg != ((<span class="keyword">const</span> <span class="keyword">struct</span> <span class="keywordtype">object</span>*)obj)-&gt;value_1;
 }

 <a class="code" href="structtommy__hashdyn__struct.html" title="Hashtable container type.">tommy_hashdyn</a> hash_0;
 <a class="code" href="structtommy__hashdyn__struct.html" title="Hashtable container type.">tommy_hashdyn</a> hash_1;
 <a class="code" href="structtommy__node__struct.html" title="Data structure node.">tommy_list</a> list;

 <span class="comment">// initializes the hash tables and the list</span>
 <a class="code" href="tommyhashdyn_8h.html#a912bebbbb99e453f9c3230948f332d76" title="Initializes the hashtable.">tommy_hashdyn_init</a>(&amp;hash_0);
 <a class="code" href="tommyhashdyn_8h.html#a912bebbbb99e453f9c3230948f332d76" title="Initializes the hashtable.">tommy_hashdyn_init</a>(&amp;hash_1);
 <a class="code" href="tommylist_8h.html#a2fc05289c0e8797ffe45e28b9d3671ff" title="Initializes the list.">tommy_list_init</a>(&amp;list);

 ...

 <span class="comment">// creates an object and inserts it</span>
 <span class="keyword">struct </span>object* obj = malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <span class="keywordtype">object</span>));
 obj-&gt;value_0 = ...;
 obj-&gt;value_1 = ...;
 <span class="comment">// inserts in the first hash table</span>
 <a class="code" href="tommyhashdyn_8h.html#adef3d60ad281f391ae1032f43f584dac" title="Inserts an element in the hashtable.">tommy_hashdyn_insert</a>(&amp;hash_0, &amp;obj-&gt;hash_node_0, obj, <a class="code" href="tommyhash_8h.html#aea9c8438064a941d13e6f5462b5bff71" title="Integer reversible hash function for 32 bits.">tommy_inthash_u32</a>(obj-&gt;value_0));
 <span class="comment">// inserts in the second hash table</span>
 <a class="code" href="tommyhashdyn_8h.html#adef3d60ad281f391ae1032f43f584dac" title="Inserts an element in the hashtable.">tommy_hashdyn_insert</a>(&amp;hash_1, &amp;obj-&gt;hash_node_1, obj, <a class="code" href="tommyhash_8h.html#aea9c8438064a941d13e6f5462b5bff71" title="Integer reversible hash function for 32 bits.">tommy_inthash_u32</a>(obj-&gt;value_1));
 <span class="comment">// inserts in the list</span>
 <a class="code" href="tommylist_8h.html#a98e34efdc68731f3e6da976e4d54ef63" title="Inserts an element at the tail of a list.">tommy_list_insert_tail</a>(&amp;list, &amp;obj-&gt;list_node, obj);

 ...

 <span class="comment">// searches an object by value_1 and deletes it</span>
 <span class="keywordtype">int</span> value_to_find = ...;
 <span class="keyword">struct </span>object* obj = <a class="code" href="tommyhashdyn_8h.html#a713b5dc93110677d6230d601909fd667" title="Searches an element in the hashtable.">tommy_hashdyn_search</a>(&amp;hash_1, search_1, &amp;value_to_find, <a class="code" href="tommyhash_8h.html#aea9c8438064a941d13e6f5462b5bff71" title="Integer reversible hash function for 32 bits.">tommy_inthash_u32</a>(value_to_find));
 <span class="keywordflow">if</span> (obj) {
     <span class="comment">// if found removes all the references</span>
     <a class="code" href="tommyhashdyn_8h.html#a0d9f4ca17314d1a0e8b7072b5fda25cc" title="Removes an element from the hashtable.">tommy_hashdyn_remove_existing</a>(&amp;hash_0, &amp;obj-&gt;hash_node_0);
     <a class="code" href="tommyhashdyn_8h.html#a0d9f4ca17314d1a0e8b7072b5fda25cc" title="Removes an element from the hashtable.">tommy_hashdyn_remove_existing</a>(&amp;hash_1, &amp;obj-&gt;hash_node_1);
     <a class="code" href="tommylist_8h.html#ad2dfbf52d6cd1a3f55d0822e90386905" title="Removes an element from the list.">tommy_list_remove_existing</a>(&amp;list, &amp;obj-&gt;list_node);
 }

 ...

 <span class="comment">// complex iterator logic</span>
 <a class="code" href="structtommy__node__struct.html" title="Data structure node.">tommy_node</a>* i = <a class="code" href="tommylist_8h.html#aa9e7b5d591c265d71d518e27f7589d47" title="Gets the head of the list.">tommy_list_head</a>(&amp;list);
 <span class="keywordflow">while</span> (i != 0) {
    <span class="comment">// get the object</span>
    <span class="keyword">struct </span>object* obj = i-&gt;<a class="code" href="structtommy__node__struct.html#a6210792ec52fa1efbfb44cf4557d9b6f" title="Pointer to the object containing the node.">data</a>;
    ...
    <span class="comment">// go to the next element</span>
    i = i-&gt;<a class="code" href="structtommy__node__struct.html#a53338f3f5366866598ed9ac7e46e64a2" title="Next node.">next</a>;
    ...
    <span class="comment">// go to the prev element</span>
    i = i-&gt;<a class="code" href="structtommy__node__struct.html#a5f5ffba676428636553612ddd809443c" title="Previous node.">prev</a>;
    ...
 }

 ...

 <span class="comment">// deallocates the objects iterating the list</span>
 <a class="code" href="tommylist_8h.html#aff0d5bf37382622516d889faac501b61" title="Calls the specified function for each element in the list.">tommy_list_foreach</a>(&amp;list, free);

 <span class="comment">// deallocates the hash tables</span>
 <a class="code" href="tommyhashdyn_8h.html#acc92e6ad011a22aa645cb35d24df27a2" title="Deinitializes the hashtable.">tommy_hashdyn_done</a>(&amp;hash_0);
 <a class="code" href="tommyhashdyn_8h.html#acc92e6ad011a22aa645cb35d24df27a2" title="Deinitializes the hashtable.">tommy_hashdyn_done</a>(&amp;hash_1);
</pre></div> </div></div>
</body>
</html>
